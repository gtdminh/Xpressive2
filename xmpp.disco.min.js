var Xmpp;(function(n){var t=function(){function n(){this._connection=null}return n.prototype.init=function(n){Strophe.debug("init disco plugin"),this._connection=n,this._identities=[],this._features=[],this._items=[],this._connection.addHandler(this._onDiscoInfo.bind(this),Strophe.NS.DISCO_INFO,"iq","get",null,null),this._connection.addHandler(this._onDiscoItems.bind(this),Strophe.NS.DISCO_ITEMS,"iq","get",null,null)},n.prototype.addIdentity=function(n,t,i,r){for(var u=0;u<this._identities.length;u++)if(this._identities[u].category==n&&this._identities[u].type==t&&this._identities[u].name==i&&this._identities[u].lang==r)return!1;return this._identities.push({category:n,type:t,name:i,lang:r}),!0},n.prototype.addFeature=function(n){for(var t=0;t<this._features.length;t++)if(this._features[t]==n)return!1;return this._features.push(n),!0},n.prototype.removeFeature=function(n){for(var t=0;t<this._features.length;t++)if(this._features[t]===n)return this._features.splice(t,1),!0;return!1},n.prototype.addItem=function(n,t,i,r){return i&&!r?!1:(this._items.push({jid:n,name:t,node:i,call_back:r}),!0)},n.prototype.info=function(n,t,i,r,u){var f={xmlns:Strophe.NS.DISCO_INFO},e;t&&(f.node=t),e=$iq({from:this._connection.jid,to:n,type:"get"}).c("query",f),this._connection.sendIQ(e,i,r,u)},n.prototype.items=function(n,t,i,r,u){var f={xmlns:Strophe.NS.DISCO_ITEMS},e;t&&(f.node=t),e=$iq({from:this._connection.jid,to:n,type:"get"}).c("query",f),this._connection.sendIQ(e,i,r,u)},n.prototype.hasIdentities=function(){return this._identities.length!==0},n.prototype.getIdentity=function(n){return this._identities[n]},n.prototype.getIdentities=function(){return this._identities},n.prototype.getFeatures=function(){return this._features},n.prototype._buildIQResult=function(n,t){var u=n.getAttribute("id"),i=n.getAttribute("from"),r=$iq({type:"result",id:u});return i!==null&&r.attrs({to:i}),r.c("query",t)},n.prototype._onDiscoInfo=function(n){var u=n.getElementsByTagName("query")[0].getAttribute("node"),i={xmlns:Strophe.NS.DISCO_INFO},r,t;for(u&&(i.node=u),r=this._buildIQResult(n,i),t=0;t<this._identities.length;t++)i.category=this._identities[t].category,i.type=this._identities[t].type,this._identities[t].name&&(i.name=this._identities[t].name),this._identities[t].lang&&(i["xml:lang"]=this._identities[t].lang),r.c("identity",i).up();for(t=0;t<this._features.length;t++)r.c("feature",{"var":this._features[t]}).up();return this._connection.send(r.tree()),!0},n.prototype._onDiscoItems=function(n){var e={xmlns:Strophe.NS.DISCO_ITEMS},i,u=n.getElementsByTagName("query")[0].getAttribute("node"),f,t,r;if(u){for(e.node=u,i=[],t=0;t<this._items.length;t++)if(this._items[t].node==u){i=this._items[t].call_back(n);break}}else i=this._items;for(f=this._buildIQResult(n,e),t=0;t<i.length;t++)r={jid:i[t].jid},i[t].name&&(r.name=i[t].name),i[t].node&&(r.node=i[t].node),f.c("item",r).up();return this._connection.send(f.tree()),!0},n}();n.Disco=t})(Xmpp||(Xmpp={})),Strophe.addConnectionPlugin("disco",function(){var n=new Xmpp.Disco;return{init:function(t){return n.init(t)},addIdentity:function(t,i,r,u){return n.addIdentity(t,i,r,u)},addFeature:function(t){return n.addFeature(t)},removeFeature:function(t){return n.removeFeature(t)},items:function(t,i,r,u,f){return n.items(t,i,r,u,f)},addItem:function(t,i,r,u){return n.addItem(t,i,r,u)},info:function(t,i,r,u,f){return n.info(t,i,r,u,f)},hasIdentities:function(){return n.hasIdentities()},getIdentity:function(t){return n.getIdentity(t)},identities:function(){return n.getIdentities()},features:function(){return n.getFeatures()}}}())