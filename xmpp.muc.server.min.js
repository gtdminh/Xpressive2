var Xmpp;(function(n){var t=function(){function t(n,t){this.serverJid=Strophe.getDomainFromJid(n),this.connection=t,this.serverInfoResponse=[],this.serverItemsResponse=[],this.rooms=[],Strophe.info("Server: new server created: "+this.serverJid)}return t.prototype.getInfo=function(){Strophe.info("Server: get info for: "+this.serverJid);var n=$iq({to:this.serverJid,type:"get"}).c("query",{xmlns:Strophe.NS.DISCO_INFO});this.connection.sendIQ(n,this.serverInfo.bind(this),this.serverInfoError.bind(this))},t.prototype.removeFromList=function(n){delete this.rooms[n],$(document).trigger("remove_room_from_list",n)},t.prototype.serverInfo=function(n){Strophe.info("Server: got info for: "+this.serverJid),this.serverInfoResponse=n;var t=$iq({to:this.serverJid,type:"get"}).c("query",{xmlns:Strophe.NS.DISCO_ITEMS});Strophe.info("Server: get items for: "+this.serverJid),this.connection.sendIQ(t,this.serverItems.bind(this),this.serverItemsError.bind(this))},t.prototype.serverInfoError=function(n){Strophe.error("ERROR: get server info for: "+this.serverJid);var t=$(n)},t.prototype.serverItems=function(t){var r=this,i;Strophe.info("Server: got items for: "+this.serverJid),this.serverItemsResponse=t,$(t).find("item").each(function(t,u){i=new n.Room($(u).attr("jid"),$(u).attr("name"),r.connection),i.getInfo(),r.rooms[i.jid]=i}),$(document).trigger("rooms_changed",this)},t.prototype.serverItemsError=function(n){Strophe.error("Server ERROR: get server items for: "+this.serverJid);var t=$(n)},t.prototype.incomingMucMessage=function(n){var r=$(n),t=r.attr("from"),u=Strophe.getBareJidFromJid(t),i=this.rooms[t];if(!i)return!1;i.incomingMucMessage(n)},t.prototype.isRoom=function(n){var t=this.getRoom(n);return t?!0:!1},t.prototype.getRoom=function(n){var t=Strophe.getBareJidFromJid(n);return this.rooms[t]},t.prototype.destroyRoom=function(n,t,i,r){var f=Strophe.getBareJidFromJid(n),u=$iq({to:f,type:"set"}).c("query",{xmlns:Strophe.NS.MUC_OWNER});i?u.c("destroy",{jid:i}):u.c("destroy"),r&&u.c("password").t(r).up(),t&&u.c("reason").t(t),this.connection.sendIQ(u.tree(),this._roomDestroyed.bind(this))},t.prototype._roomDestroyed=function(n){var t=$(n).attr("from");this.removeFromList(t)},t}();n.Server=t})(Xmpp||(Xmpp={}))