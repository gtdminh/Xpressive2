var Xmpp;(function(n){var t=function(){function n(){this.discoInfo=[],this.discoItems=[]}return n.prototype.onDiscoInfo=function(n){Strophe.info("got disco#info response."),this.discoInfo=n;var t=$iq({to:this.jid(),type:"get"}).c("query",{xmlns:Strophe.NS.DISCO_ITEMS});Strophe.info("request disco#items."),this.conn.sendIQ(t,this.onDiscoItems.bind(this),this.onItemsError.bind(this))},n.prototype.onInfoError=function(n){n===null?Strophe.warn("disco#info timed out."):Strophe.error("disco#info returned an error.")},n.prototype.onDiscoItems=function(n){Strophe.info("got disco#items response."),this.discoItems=n,this.conn.muc&&this.conn.muc.processDiscoItems(n),this.conn.pubsub&&this.conn.pubsub.processDiscoItems(n)},n.prototype.onItemsError=function(n){n===null?Strophe.warn("disco#info timed out."):Strophe.error("disco#info returned an error.")},n.prototype.init=function(n){Strophe.debug("init session plugin"),this.conn=n,this.jid=function(){return Strophe.getDomainFromJid(this.conn.jid)}},n.prototype.statusChanged=function(n){n===Strophe.Status.CONNECTED||n===Strophe.Status.ATTACHED||n===Strophe.Status.DISCONNECTED&&(this.discoInfo=[])},n.prototype.disconnect=function(){this.conn.disconnect()},n.prototype.sessionInit=function(){var n=$iq({type:"get"}).c("query",{xmlns:Strophe.NS.DISCO_INFO});Strophe.info("request info"),this.conn.sendIQ(n,this.onDiscoInfo.bind(this),this.onInfoError.bind(this))},n.prototype.unhandledIq=function(){return Strophe.info("Unhandled Iq"),!0},n}();n.Session=t})(Xmpp||(Xmpp={})),Strophe.addConnectionPlugin("session",function(){var n=new Xmpp.Session;return{init:function(t){return n.init(t)},statusChanged:function(t){return n.statusChanged(t)},sessionInit:function(){return n.sessionInit()},disconnect:function(){return n.disconnect()},unhandledIq:function(t){return n.unhandledIq(t)}}}())