var Xmpp;(function(n){function e(n){return o(r(u(n),n.length*t))}function r(n,t){var v,r,y;n[t>>5]|=128<<24-t%32,n[(t+64>>9<<4)+15]=t;var h=Array(80),u=1732584193,e=-271733879,o=-1732584194,s=271733878,c=-1009589776;for(v=0;v<n.length;v+=16){var p=u,w=e,b=o,k=s,d=c;for(r=0;r<80;r++)h[r]=r<16?n[v+r]:f(h[r-3]^h[r-8]^h[r-14]^h[r-16],1),y=i(i(f(u,5),l(r,e,o,s)),i(i(c,h[r]),a(r))),c=s,s=o,o=f(e,30),e=u,u=y;u=i(u,p),e=i(e,w),o=i(o,b),s=i(s,k),c=i(c,d)}return Array(u,e,o,s,c)}function l(n,t,i,r){return n<20?t&i|~t&r:n<40?t^i^r:n<60?t&i|t&r|i&r:t^i^r}function a(n){return n<20?1518500249:n<40?1859775393:n<60?-1894007588:-899497514}function i(n,t){var i=(n&65535)+(t&65535),r=(n>>16)+(t>>16)+(i>>16);return r<<16|i&65535}function f(n,t){return n<<t|n>>>32-t}function u(n){for(var r=Array(),u=(1<<t)-1,i=0;i<n.length*t;i+=t)r[i>>5]|=(n.charCodeAt(i/t)&u)<<32-t-i%32;return r}function o(n){for(var r="",u,i,t=0;t<n.length*4;t+=3)for(u=(n[t>>2]>>8*(3-t%4)&255)<<16|(n[t+1>>2]>>8*(3-(t+1)%4)&255)<<8|n[t+2>>2]>>8*(3-(t+2)%4)&255,i=0;i<4;i++)r+=t*8+i*6>n.length*32?c:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(u>>6*(3-i)&63);return r}var s=function(){function n(){this.capsReqQ=[]}return n.prototype.init=function(n){if(Strophe.debug("init caps plugin"),this.connection=n,this.capsCache=[],Strophe.addNamespace("CAPS","http://jabber.org/protocol/caps"),this.connection.disco===void 0)throw new Error("disco plugin required!");if(e===void 0)throw new Error("SHA-1 library required!");this.addFeature(Strophe.NS.CAPS),this.addFeature(Strophe.NS.DISCO_INFO),this.connection.disco.hasIdentities()||this.connection.disco.addIdentity("client","pc","XpressiveJS 0.2","")},n.prototype.statusChanged=function(n){(n===Strophe.Status.CONNECTED||n===Strophe.Status.ATTACHED)&&this.connection.addTimedHandler(5e3,this.requestCaps.bind(this))},n.prototype.requestCaps=function(){var n,t;return this.capsReqQ.length>0&&(n=this.capsReqQ.pop(),Strophe.debug("Capabilities info requested"),t=$iq({type:"get",to:n.jid}).c("query",{node:n.capsNode,xmlns:Strophe.NS.DISCO_INFO}),this.connection.sendIQ(t,this.addToCache.bind(this))),!0},n.prototype.findCaps=function(n){return this.capsCache[n]},n.prototype.getCaps=function(n,t){Strophe.debug("Capabilities info request queued"),this.capsReqQ.push({jid:n,capsNode:t})},n.prototype.addToCache=function(n){try{Strophe.debug("Capabilities info recv'd.");var t=$(n).find("query"),i=t.attr("node");this.capsCache[i]=t}catch(r){Strophe.error("Capabilities info handler errored.")}return!1},n.prototype.addFeature=function(n){return this.connection.disco.addFeature(n)},n.prototype.removeFeature=function(n){return this.connection.disco.removeFeature(n)},n.prototype.sendPres=function(){return this.connection.send($pres().cnode(this.createCapsNode().tree()))},n.prototype.createCapsNode=function(){var n;return n=this.connection.disco.hasIdentities()?this.connection.disco.getIdentity(0).name||"":"dummyId.name",$build("c",{xmlns:Strophe.NS.CAPS,hash:"sha-1",node:n,ver:this.generateVerificationString()})},n.prototype.propertySort=function(n,t){return n.sort(function(n,i){return n[t]>i[t]?-1:1})},n.prototype.generateVerificationString=function(){var r,t,c,i,n,l,a,v,u,f,o,y,p,w,s,h;for(n=[],s=this.connection.disco.identities,u=0,y=s.length;u<y;u++)c=s[u],n.push(c);for(t=[],h=this.connection.disco.features,f=0,p=h.length;f<p;f++)l=h[f],t.push(l);r="",this.propertySort(n,"category"),this.propertySort(n,"type"),this.propertySort(n,"lang");for(a in n)i=n[a],r+=""+i.category+"/"+i.type+"/"+i.lang+"/"+i.name+"<";for(t.sort(),o=0,w=t.length;o<w;o++)v=t[o],r+=""+v+"<";return""+e(r)+"="},n}();n.Caps=s;var h=0,c="",t=8})(Xmpp||(Xmpp={})),Strophe.addConnectionPlugin("caps",function(){var n=new Xmpp.Caps;return{init:function(t){return n.init(t)},statusChanged:function(t){return n.statusChanged(t)},removeFeature:function(t){return n.removeFeature(t)},addFeature:function(t){return n.addFeature(t)},sendPres:function(){return n.sendPres()},generateVerificationString:function(){return n.generateVerificationString()},createCapsNode:function(){return n.createCapsNode()},findCaps:function(t){return n.findCaps(t)},getCaps:function(t,i){return n.getCaps(t,i)}}}())