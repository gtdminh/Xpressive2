var Xmpp;(function(n){var t=function(){function n(){}return n.fill=function(n,t,i){var r,u,e,f;for(f=[],u=0,e=n.length;u<e;u++)r=n[u],f.push(t.push(r instanceof i?r:new i(r)));return f},n.createHtmlFieldCouple=function(n){var t,i,r,u,f;return t=$("<tr>"),i="Strophe-x-Field-"+n.type+"-"+n["var"].replace(/#/g,"-"),r=" class='Field-"+n.type+"' ",u=$("<td>").append("<label"+r+"for='"+i+"'>"+n.label+"<\/label>"),f=$("<td>").append($(n.toHTML()).attr("id",i)),t.append(u).append(f),t},n.getHtmlFields=function(n){return $(n).find("input, select, textarea")},n}(),u=function(){function r(n){this.fields=[],(n!=null?n.fields:void 0)&&t.fill(n.fields,this.fields,i)}return r.prototype.toXML=function(){var r,t,n,u,i;for(t=$build("item"),i=this.fields,n=0,u=i.length;n<u;n++)r=i[n],t.cnode(r.toXML()).up();return t.tree()},r.prototype.toJSON=function(){var r,n,t,u,i;if(n={},this.fields)for(n.fields=[],i=this.fields,t=0,u=i.length;t<u;t++)r=i[t],n.fields.push(r.toJSON());return n},r.prototype.toHTML=function(){var u,i,n,f,r;for(i=$("<fieldset class='Field-item'>"),r=this.fields,n=0,f=r.length;n<f;n++)u=r[n],t.createHtmlFieldCouple(u).appendTo(i);return i[0]},r.fromXML=function(t){var u,r;return t=$(t),r=t.find("field"),new n.Item({fields:function(){var n,f,t;for(t=[],n=0,f=r.length;n<f;n++)u=r[n],t.push(i.fromXML(u));return t}()})},r.fromHTML=function(r){var u;return new n.Item({fields:function(){var n,o,f,e;for(f=t.getHtmlFields(r),e=[],n=0,o=f.length;n<o;n++)u=f[n],e.push(i.fromHTML(u));return e}()})},r}(),r,i,f,e;n.Item=u,r=function(){function t(n){this.label="",this.value="",n&&(n.label&&(this.label=n.label.toString()),n.value&&(this.value=n.value.toString()))}return t.prototype.toXML=function(){return $build("option",{label:this.label}).c("value").t(this.value.toString()).tree()},t.prototype.toJSON=function(){return{label:this.label,value:this.value}},t.prototype.toHTML=function(){return $("<option class='Field-option'>").attr("value",this.value).text(this.label||this.value)[0]},t.fromXML=function(t){return new n.Option({label:$(t).attr("label"),value:$(t).text()})},t.fromHTML=function(t){return new n.Option({value:$(t).attr("value"),label:$(t).text()})},t}(),n.Option=r,i=function(){function i(n){this._types=["boolean","fixed","hidden","jid-multi","jid-single","list-multi","list-single","text-multi","text-private","text-single"],this._multiTypes=["list-multi","jid-multi","text-multi","hidden"],this.type="text-single",this.desc=null,this.label=null,this.required=!1;var i,t;this.options=[],this.values=[],n&&(this._types.indexOf(n.type)>=0&&(this.type=n.type.toString()),n.desc&&(this.desc=n.desc.toString()),n.label&&(this.label=n.label.toString()),this["var"]=((t=n["var"])!=null?t.toString():void 0)||"_no_var_was_defined_",this.required=n.required===!0||n.required==="true",n.options&&this.addOptions(n.options),n.value&&(n.values=[n.value]),n.values&&(this.values=n.values))}return i.prototype.addOption=function(n){return this.addOptions([n])},i.prototype.addOptions=function(n){var i;return(this.type==="list-single"||this.type==="list-multi")&&(typeof n[0]!="object"&&(n=function(){var t,f,u;for(u=[],t=0,f=n.length;t<f;t++)i=n[t],u.push(new r({value:i.toString()}));return u}()),t.fill(n,this.options,r)),this},i.prototype.toJSON=function(){var n,r,t,u,i;if(n={type:this.type,"var":this["var"],required:this.required},this.desc&&(n.desc=this.desc),this.label&&(n.label=this.label),this.values&&(n.values=this.values),this.options)for(n.options=[],i=this.options,t=0,u=i.length;t<u;t++)r=i[t],n.options.push(r.toJSON());return n},i.prototype.toXML=function(){var r,e,o,n,t,i,s,h,u,f;if(r={type:this.type,"var":this["var"]},this.label&&(r.label=this.label),n=$build("field",r),this.desc&&n.c("desc").t(this.desc).up(),this.required&&n.c("required").up(),this.values)for(u=this.values,t=0,s=u.length;t<s;t++)o=u[t],n.c("value").t(o.toString()).up();if(this.options)for(f=this.options,i=0,h=f.length;i<h;i++)e=f[i],n.cnode(e.toXML()).up();return n.tree()},i.prototype.toHTML=function(){var n,l,a,u,t,f,w,i,r,v,y,e,o,s,b="Field-"+this.type.toLowerCase(),p=this.type.toLowerCase(),h,c;switch(p){case"list-single":case"list-multi":if(n=$("<select>"),this.type==="list-multi"&&n.attr("multiple","multiple"),this.options.length>0)for(e=this.options,i=0,v=e.length;i<v;i++)if(t=e[i],t){for(u=$(t.toHTML()),o=this.values,r=0,y=o.length;r<y;r++)l=o[r],l.toString()===t.value.toString()&&u.attr("selected","selected");u.appendTo(n)}break;case"text-multi":case"jid-multi":n=$("<textarea>"),f=function(){var n,r,t,i;for(t=this.values,i=[],n=0,r=t.length;n<r;n++)a=t[n],i.push(a);return i}.call(this).join("\n"),f&&n.text(f);break;case"boolean":n=$("<select>"),n.attr("boolean","boolean"),h=$("<option class='Field-option'>").attr("value","1").text("Yes"),c=$("<option class='Field-option'>").attr("value","0").text("No"),this.values[0]&&(this.values[0]==="1"||this.values[0]==="true")?h.attr("selected","selected"):c.attr("selected","selected"),h.appendTo(n),c.appendTo(n);break;case"text-single":case"text-private":case"hidden":case"fixed":case"jid-single":n=$("<input>"),this.values&&p!=="boolean"&&n.val(this.values[0]);switch(this.type.toLowerCase()){case"text-single":n.attr("type","text"),n.attr("placeholder",this.desc);break;case"boolean":n.attr("type","checkbox"),w=(s=this.values[0])!=null?typeof s.toString=="function"?s.toString():void 0:void 0,this.values[0]&&(this.values[0]==="true"||this.values[0]==="1")&&n.attr("checked","checked");break;case"text-private":n.attr("type","password");break;case"hidden":n.attr("type","hidden");break;case"fixed":n.attr("type","text").attr("readonly","readonly");break;case"jid-single":n.attr("type","email")}break;default:n=$("<input type='text'>")}return n.addClass(b),n.attr("name",this["var"]),this.required&&n.attr("required",this.required),n[0]},i.fromXML=function(t){var i,u;return t=$(t),new n.Field({type:t.attr("type"),"var":t.attr("var"),label:t.attr("label"),desc:t.find("desc").text(),required:t.find("required").length===1,values:function(){var n,f,i,r,e;for(i=t.find("field > value"),r=[],n=0,f=i.length;n<f;n++)u=i[n],e=$(u).text(),r.push(e);return r}(),options:function(){var n,e,u,f,o;for(u=t.find("option"),f=[],n=0,e=u.length;n<e;n++)i=u[n],o=r.fromXML(i),f.push(o);return f}()})},i._htmlElementToFieldType=function(n){var i,t;n=$(n);switch(n[0].nodeName.toLowerCase()){case"textarea":t="text-multi";break;case"select":t=n.attr("boolean")?"boolean":n.attr("multiple")==="multiple"?"list-multi":"list-single";break;case"input":switch(n.attr("type")){case"email":t="jid-single";break;case"hidden":t="hidden";break;case"password":t="text-private";break;case"text":i=n.attr("readonly")==="readonly",t=i?"fixed":"text-single"}}return t},i.fromHTML=function(t){var u,i,f,e;t=$(t),e=n.Field._htmlElementToFieldType(t),i=new n.Field({type:e,"var":t.attr("name"),required:t.attr("required")==="required"});switch(e){case"list-multi":case"list-single":case"boolean":i.values=function(){var n,f,i,r;for(i=t.find("option:selected"),r=[],n=0,f=i.length;n<f;n++)u=i[n],r.push($(u).val());return r}(),i.options=function(){var n,e,i,f;for(i=t.find("option"),f=[],n=0,e=i.length;n<e;n++)u=i[n],f.push(r.fromHTML(u));return f}();break;case"text-multi":case"jid-multi":f=t.text(),f.trim()!==""&&(i.values=f.split("\n"));break;case"text-single":case"text-private":case"hidden":case"fixed":case"jid-single":t.val().trim()!==""&&(i.values=[t.val()])}return i},i}(),n.Field=i,f=function(){function r(n){this._types=["form","submit","cancel","result"],this.type="form",this.title=null,this.instructions=null;var e,h,r,f,c,l,v,o,s,a;if(this.fields=[],this.items=[],this.reported=[],n)if(this._types.indexOf.call(n.type)>=0&&(this.type=n.type),this.title=n.title,this.instructions=n.instructions,t.fill=function(n,t,i){var r,u,e,f;for(f=[],u=0,e=n.length;u<e;u++)r=n[u],f.push(t.push(r instanceof i?r:new i(r)));return f},n.fields)n.fields&&t.fill(n.fields,this.fields,i);else if(n.items)for(n.items&&t.fill(n.items,this.items,u),o=this.items,r=0,c=o.length;r<c;r++)for(h=o[r],s=h.fields,f=0,l=s.length;f<l;f++)e=s[f],(a=e["var"],this.reported.indexOf(a)>=0)||this.reported.push(e["var"])}return r.prototype.toXML=function(){var o,s,h,n,t,i,r,c,l,a,u,f,e;if(n=$build("x",{xmlns:"jabber:x:data",type:this.type}),this.title&&n.c("title").t(this.title.toString()).up(),this.instructions&&n.c("instructions").t(this.instructions.toString()).up(),this.fields.length>0)for(u=this.fields,t=0,c=u.length;t<c;t++)o=u[t],n.cnode(o.toXML()).up();else if(this.items.length>0){for(n.c("reported"),f=this.reported,i=0,l=f.length;i<l;i++)h=f[i],n.c("field",{"var":h}).up();for(n.up(),e=this.items,r=0,a=e.length;r<a;r++)s=e[r],n.cnode(s.toXML()).up()}return n.tree()},r.prototype.toJSON=function(){var f,e,n,t,i,o,s,r,u;if(n={type:this.type},this.title&&(n.title=this.title),this.instructions&&(n.instructions=this.instructions),this.fields.length>0)for(n.fields=[],r=this.fields,t=0,o=r.length;t<o;t++)f=r[t],n.fields.push(f.toJSON());else if(this.items.length>0)for(n.items=[],n.reported=this.reported,u=this.items,i=0,s=u.length;i<s;i++)e=u[i],n.items.push(e.toJSON());return n},r.prototype.toHTML=function(){var o,n,s,i,r,h,c,u,f,e;if(n=$("<form class='x-form' data-type='"+this.type+"'>"),this.title&&n.append("<h1 class='x-title'>"+this.title+"<\/h1>"),this.instructions&&n.append("<p class='x-instructions'>"+this.instructions+"<\/p>"),e=$("<table>"),e.appendTo(n),this.fields.length>0)for(u=this.fields,i=0,h=u.length;i<h;i++)o=u[i],t.createHtmlFieldCouple(o).appendTo(e);else if(this.items.length>0)for(f=this.items,r=0,c=f.length;r<c;r++)s=f[r],$(s.toHTML()).appendTo(n);return n[0]},r.fromXML=function(t){var r,f,c,o,e,l,a,s,h;return t=$(t),r=new n.Form({type:t.attr("type")}),h=t.find("title"),h.length===1&&(r.title=h.text()),o=t.find("instructions"),o.length===1&&(r.instructions=o.text()),f=t.find("field"),e=t.find("item"),e.length>0?r.items=function(){var n,i,t,r;for(t=[],n=0,i=e.length;n<i;n++)c=e[n],r=u.fromXML(c),t.push(r);return t}():f.length>0&&(r.fields=function(){var n,r,t,u;for(t=[],n=0,r=f.length;n<r;n++)l=f[n],u=i.fromXML(l),t.push(u);return t}()),s=t.find("reported"),s.length===1&&(f=s.find("field"),r.reported=function(){var n,i,t;for(t=[],n=0,i=f.length;n<i;n++)a=f[n],t.push($(a).attr("var"));return t}()),r},r.fromHTML=function(r){var f,c,e,p,l,w,o,b,a,s,h,k,d,v,y,g;if(r=$(r),f=new n.Form({type:r.attr("data-type")}),a=r.find("h1").text(),a&&(f.title=a),l=r.find("p").text(),l&&(f.instructions=l),o=r.find("fieldset"),e=t.getHtmlFields(r),o.length>0)for(f.items=function(){var n,i,t;for(t=[],n=0,i=o.length;n<i;n++)p=o[n],t.push(u.fromHTML(p));return t}(),v=f.items,s=0,k=v.length;s<k;s++)for(w=v[s],y=w.fields,h=0,d=y.length;h<d;h++)c=y[h],(g=c["var"],f.reported.indexOf(g)>=0)||f.reported.push(c["var"]);else e.length>0&&(f.fields=function(){var n,r,t;for(t=[],n=0,r=e.length;n<r;n++)b=e[n],t.push(i.fromHTML(b));return t}());return f},r}(),n.Form=f,e=function(){function n(){}return n.prototype.init=function(n){return Strophe.addNamespace("DATA","jabber:x:data"),n.disco?n.disco.addFeature(Strophe.NS.DATA):void 0},n.prototype.parseFromResult=function(n){var t;return n.nodeName.toLowerCase()==="x"?f.fromXML(n):f.fromXML((t=$(n).find("x"))!=null?t[0]:void 0)},n}(),n.x=e})(Xmpp||(Xmpp={}))