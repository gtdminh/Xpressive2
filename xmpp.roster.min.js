var Xmpp;(function(n){var t=function(){function t(){this.contacts=null}return t.prototype.init=function(t){Strophe.debug("init roster plugin"),this.conn=t,this.contacts=new n.Contacts(t)},t.prototype.statusChanged=function(t){var r=this,u,i;try{if(t===Strophe.Status.CONNECTED)this.contacts=new n.Contacts(this.conn),this.conn.addHandler(this.contacts.rosterChanged.bind(this.contacts),Strophe.NS.ROSTER,"iq","set"),this.conn.addHandler(this.contacts.presenceChanged.bind(this.contacts),null,"presence"),u=$iq({type:"get"}).c("query",{xmlns:Strophe.NS.ROSTER}),this.conn.sendIQ(u,function(t){Strophe.info("roster_iq received."),$(t).find("item").each(function(t,u){i=new n.Contact(u),r.contacts.list[$(u).attr("jid")]=i}),$(document).trigger("roster_changed",r.contacts),r.conn.me.available()});else if(t===Strophe.Status.DISCONNECTED){for(i in this.contacts.list)this.contacts.list[i].resources={};$(document).trigger("roster_changed",this.contacts)}}catch(f){console.log(f)}},t.prototype.chatToDirect=function(t){try{var i=this.findContact(Strophe.getBareJidFromJid(t));return i||(i=new n.Contact(null,t)),i}catch(r){console.log(r)}},t.prototype.chatTo=function(n){return this.findContact(Strophe.getBareJidFromJid(n))},t.prototype.findContact=function(n){for(var t in this.contacts.list)if(t===n)return this.contacts.list[t];return null},t.prototype.deleteContact=function(n){try{var t=$iq({type:"set"}).c("query",{xmlns:Strophe.NS.ROSTER}).c("item",{jid:n,subscription:"remove"});this.conn.sendIQ(t)}catch(i){console.log(i)}},t.prototype.addContact=function(n,t,i){try{var u=$iq({type:"set"}).c("query",{xmlns:Strophe.NS.ROSTER}).c("item",{name:t||"",jid:n}),r=i.split(" ");r&&r.length>0&&$.each(r,function(){this.length>0&&u.c("group").t(this).up()}),this.conn.sendIQ(u)}catch(f){console.log(f)}},t.prototype.modifyContact=function(n,t,i){this.addContact(n,t,i)},t.prototype.subscribe=function(n,t,i){try{this.addContact(n,t,i);var r=$pres({to:n,type:"subscribe"});this.conn.send(r)}catch(u){console.log(u)}},t.prototype.unsubscribe=function(n){try{var t=$pres({to:n,type:"unsubscribe"});this.conn.send(t),this.deleteContact(n)}catch(i){console.log(i)}},t}();n.Roster=t})(Xmpp||(Xmpp={})),Strophe.addConnectionPlugin("roster",function(){var n=new Xmpp.Roster;return{init:function(t){return n.init(t)},statusChanged:function(t){return n.statusChanged(t)},chatTo:function(t){return n.chatTo(t)},chatToDirect:function(t){return n.chatToDirect(t)},findContact:function(t){return n.findContact(t)},deleteContact:function(t){return n.deleteContact(t)},addContact:function(t,i,r){return n.addContact(t,i,r)},modifyContact:function(t,i,r){return n.modifyContact(t,i,r)},subscribe:function(t,i,r){return n.subscribe(t,i,r)},unsubscribe:function(t){return n.unsubscribe(t)}}}())