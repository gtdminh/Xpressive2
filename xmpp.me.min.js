var Xmpp;(function(n){var t=function(){function n(n){this.jid="",this.password="",this.statusObj={"default":"...processing",unavailable:"Unavailable",available:"Online, Available",chat:"Chatting",away:"Away",xa:"Extended Away",dnd:"Do not disturb",disconnected:"Not connected",authfail:"Authorization failed",connfail:"Connection failed",authenticating:"Authenticating..."},this.xpressive=n,this._this=this}return n.prototype.init=function(n){Strophe.debug("init me plugin"),this._this.conn=n,this._this.conn.addHandler(this._onVersionIq.bind(this._this),Strophe.NS.VERSION,"iq","get",null,null)},n.prototype.statusChanged=function(n){var t=this._this;switch(n){case Strophe.Status.CONNECTED:this.jid=this.conn.jid,this.setStatus("connected"),t.conn.disco.addFeature(Strophe.NS.VERSION);break;case Strophe.Status.CONNECTING:this.setStatus("connecting");break;case Strophe.Status.DISCONNECTING:this.setStatus("disconnecting");break;case Strophe.Status.DISCONNECTED:this.setStatus("disconnected");break;case Strophe.Status.CONNFAIL:this.setStatus("connfail");break;case Strophe.Status.AUTHENTICATING:this.setStatus("authenticating");break;case Strophe.Status.AUTHFAIL:this.setStatus("authfail")}},n.prototype._onVersionIq=function(n){var t=$(n),r=t.attr("id"),u=t.attr("from"),i=$iq({to:u,type:"result",id:r});return i.c("query",{xmlns:Strophe.NS.VERSION}).c("name",null,"XpressiveJS").c("version",null,"0.1"),this.conn.send(i.tree()),!0},n.prototype.setNickname=function(n){this.nickname=n,$(document).trigger("my_status_changed",this)},n.prototype.getNickname=function(){if((this.nickname||"").length===0){var n=this.xpressive.getSetting("nickname");(n||"").length===0&&(n=Strophe.getNodeFromJid(this.jid)),this.setNickname(n)}return this.nickname},n.prototype.setStatus=function(n,t){var i=this.status;(i!==n||(t||"")!==this.info)&&(Strophe.debug("Status change: "+i+" > "+n+" ["+t+"]"),this.info=t||"",this.status=n,$(document).trigger("my_status_changed",this),i==="connected"?this.conn.caps.sendPres():this.sendPresence())},n.prototype.statusToString=function(){return this.statusObj[this.status]||this.statusObj["default"]},n.prototype.extendedStatusToString=function(){var n=this.statusToString();return this.info.length>0&&(n+=" : "+this.info),n},n.prototype.sendPresence=function(){if(this.conn!==undefined)switch(this.status){case"unavailable":this.conn.send($pres({type:"unavailable"}).tree());return;case"available":this.conn.send($pres());return;case"away":case"xa":case"chat":case"dnd":var n=$pres().c("show",null,this.status);this.info.length>0&&n.c("status",null,this.info),this.conn.send(n.tree());return}},n.prototype.myJid=function(){return Strophe.getBareJidFromJid(this.jid)},n.prototype.changeStatus=function(n,t){this.setStatus(n,t)},n.prototype.available=function(){this.setStatus("available")},n.prototype.away=function(){this.setStatus("away")},n.prototype.chat=function(){this.setStatus("chat")},n.prototype.xa=function(){this.setStatus("xa")},n.prototype.dnd=function(){this.setStatus("dnd")},n.prototype.offline=function(){this.setStatus("unavailable")},n}();n.Me=t})(Xmpp||(Xmpp={})),Strophe.addConnectionPlugin("me",function(){var n=new Xmpp.Me(Xpressive);return{init:function(t){return n.init(t)},statusChanged:function(t){return n.statusChanged(t)},changeStatus:function(t,i){return n.changeStatus(t,i)},available:function(){return n.available()},away:function(){return n.away()},chat:function(){return n.chat()},xa:function(){return n.xa()},dnd:function(){return n.dnd()},offline:function(){return n.offline()},myJid:function(){return n.myJid()},myNickname:function(){return n.getNickname()}}}())